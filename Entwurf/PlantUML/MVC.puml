@startuml MVC

namespace Model {

    class MapPin {
        <<constructor>> MapPin(position : Position)

        + getPosition() : Position
        + setPosition(position : Position) : void

        + getValue() : number
        + setValue(value : number) : void

        + getStationId() : string
        + setStationId(id : string) : void

        + getColor() : Color
        + setColor(color : Color) : void
    }

    class Viewport {
        + getCenter() : Position
        + setCenter(position : Position) : void

        + getZoom() : number
        + setZoom(zoom : number) : void

        + getRadius() : number
    }
    
    class ObservationStation {
        -id : number
        -name : String
        - description : String
        -position : Position
        -availableFeatures : List<Feature>

        + getId : number
        + getName() : string
        + getDescription() : String
        + getFeatures() : List<Feature>
        + getPosition() : Position
        + isLimitExceeded(feature : Feature) : Boolean
        + hasFeature(feature : Feature) : Boolean
        + getDiagrams() : DetailPage.Diagram[]
    }
   
    class Observation {
        observationStation : ObservationStation
        feature : Feature
        dateTime : Date
        value : number

        + getValue() : number
        + getObservationStation() : ObservationStation
        + getFeature() : Feature
        + getDateTime : Date
    }

    enum Timespan {
            LAST_YEAR,
            LAST_3_MONTHS,
            LAST_MONTH,
            LAST_WEEK,
            LAST_3_DAYS,
            TODAY,
        }
    
    class Position {
        xCoordinate : number
        yCoordinate : number
    }

    class Feature {
        - id : number
        - name : String
        - description : String
        - scale : Scale
        - fallbackScale : Scale
        - relatedWeblink : String
        - drawableDiagrams : DetailPage.Diagram[]
        - limit : number
        {static} + getFeature(featureID : number) : Feature
        {static} + getFeature(featureName : String) : Feature
        {static} + getRegisteredFeatures() : Feature[]
        + getID() : number
        + getName() : String
        + getDescription() : String
        + getRelatedScale() : Scale
        + getRelatedWeblink() : String
        + getDrawableDiagrams() : DetailPage.Diagram[]
        + getLimit : number
    }

    enum Colors {
        GREEN = "#50EE70"
        LIGHTGREEN = "#AAFF55"
        YELLOW = "#FFFF00"
        ORANGE = "#FFA500"
        RED = "#FF0000" 
    }

    class Color {
        + getRGB() : string
        + setRGB(hex : string) : void
    }

    class ColorCode {
        color : Colors
        + getColor(value : number)
    }

    class Scale {
        -colors : Colors[]
        +listAllColors() : Colors
        + getColor(value : number) : Color
    }

}

namespace View {
    namespace Components {
        namespace MapPage {
            class FeatureSelect {
                + getSelectedFeature() : Feature
                + setFeature(feature : Feature)
            }
            class Search {
                + State.searchTerm : string
                + onSearch(string searchTerm) : void
                + onLocationSearch() : void
                + reset() : void
            }

            class MapView {
            + selectStation(station : Messstation)
            + getValueAt(position: Position, feature : Feature) : number
            + onViewportChange(viewport : Viewport)
            + onStationSelected(pin : MapPin)
        }
            class Map {
                + Props.pins : MapPin[]
                + Props.polygons : Polygon[]
                + Props.onViewportChange()
            }
            class Legend {
                + Pros.scale : Scale
            }
        }
        namespace DetailPage {
            class ObservationStationInfo
            class LocationMap
            abstract Diagram {
                - feature : Feature
                + draw() : void
                + setObservationStation(observationStation : Model.ObservationStation) : void
                + loadData() : void
                + isDataLoaded() : Boolean
            }
            class FeatureHistoryLineChart extends Diagram
            class YearComparisonLineChart extends Diagram
            class ComparisonToLastYearPieChart extends Diagram
        }
    }

    namespace Layout {
        class MapPage
        class DetailPage
        class ErrorPage {
            + errorCode : number
            + errorMessage : string
        }
        class PrivacyPolicyPage
        class AboutPage
        class PageMenu
        class LanguageMenu
        class TopBar
    }
}


namespace Controller {
    namespace Frost {
        class FROSTServer {
            + setUrl(url : string) : void
            + getUrl() : string
        }

        class FROSTQuery {
            + send() : QueryResult
            + setTop(n : number) : void           
            + setSkip(n : number) : void
            + enableCount(set : boolean) : void
            + setOrderBy(orderBy : string) : void
            + setSelect(select : string) : void
            + setFilter(filter : string) : void
            + setExpand(expand : string) : void
            + setId(id : string) : void
        }

        interface QueryResult
        class DataProvider {
            + getLatestObservations(center : Position, radius: number, feature : Feature) : Observation[]
            + getLatestObservation(station : ObservationStation, feature : Feature) : Observation
            + getStationsIn(middle: Position, radius : number) : Station[]
            + getHistoricalObservations(station : Station, start : Date, end : Date, feature : Feature) : Observation[]
            + getHistoricalObservations(station : Station, start : Date, end : Date, frequency : Frequency, feature : Feature) : Observation[]
            + getStation(id : string) : Station
            + getFeature(id : string) : Feature
        }
        class FeatureProvider {
            makeFeature(id : string) : Feature
            getScale(feature : Feature) : Scale
        }
    }
    namespace Storage {
        class Language {
            + getString(id: string) : string
            + loadLanguage(languageId : string)
        }

        class MapConfigurationMemory {
            + save(MapConfiguration conf, viewport : Viewport)
            + load() : (MapConfiguration, Viewport)
        }
    }

    class MapController {
        + handlePopup(pin : MapPin) : (Station, Observation)
        + handleViewportChange(viewport : Viewport)
        --
        + getPins() : MapPin[]
        + getPolygons() : Polygon[]

        + changeFeature(feature : Feature) : void
        + onConfigurationChange(mapConf : MapConfiguration) : void
        + search(searchTerm : string) : void
        + updateCurrentPosition() : void
    }

    abstract MapConfiguration {
        + getPins(port : Viewport) : MapPin[]
        + getPolygons(port: Viewport) : Polygon[]
        + getScale() : Scale
        + getFeatures() : Feature[]
    }

    class StationConfiguration extends MapConfiguration {
        + setFeature(feature : Feature)
    }

    class PolygonConfiguration extends MapConfiguration {
        + setFeature(feature : Feature)
    }

    class NearConfiguration extends MapConfiguration {
        + radius : number
        --
        + setFeature(feature : Feature)
    }

    class DetailController {
        
    }


}

@enduml
